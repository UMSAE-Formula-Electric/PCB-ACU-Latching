Version 4
SHEET 1 2752 1652
WIRE 832 -400 768 -400
WIRE 928 -400 832 -400
WIRE 224 -368 160 -368
WIRE 320 -368 224 -368
WIRE 768 -368 768 -400
WIRE 160 -336 160 -368
WIRE -528 -320 -624 -320
WIRE -448 -320 -528 -320
WIRE -624 -288 -624 -320
WIRE 768 -256 768 -288
WIRE 928 -256 768 -256
WIRE 1072 -256 928 -256
WIRE 768 -240 768 -256
WIRE 160 -224 160 -256
WIRE 272 -224 160 -224
WIRE 400 -224 272 -224
WIRE 160 -208 160 -224
WIRE -272 -176 -352 -176
WIRE -224 -176 -272 -176
WIRE -352 -144 -352 -176
WIRE -224 -144 -224 -176
WIRE -160 -144 -224 -144
WIRE -160 -80 -160 -144
WIRE -80 -80 -160 -80
WIRE -352 -64 -352 -96
WIRE -528 -32 -608 -32
WIRE -432 -32 -528 -32
WIRE 448 -32 400 -32
WIRE 496 -32 448 -32
WIRE -608 16 -608 -32
WIRE 400 32 400 -32
WIRE 240 48 208 48
WIRE 272 48 240 48
WIRE 208 112 208 48
WIRE 64 128 -32 128
WIRE 176 128 64 128
WIRE 400 144 400 112
WIRE 400 144 240 144
WIRE 560 144 400 144
WIRE 624 144 560 144
WIRE -272 160 -288 160
WIRE -256 160 -272 160
WIRE -192 160 -256 160
WIRE -32 160 -112 160
WIRE 64 160 -32 160
WIRE 176 160 64 160
WIRE -256 192 -256 160
WIRE 208 224 208 176
WIRE 448 240 400 240
WIRE 496 240 448 240
WIRE -256 304 -256 272
WIRE 400 304 400 240
WIRE 240 320 208 320
WIRE 272 320 240 320
WIRE 208 384 208 320
WIRE -32 400 -32 160
WIRE 64 400 -32 400
WIRE 176 400 64 400
WIRE 1792 400 1712 400
WIRE 1888 400 1792 400
WIRE 400 416 400 384
WIRE 400 416 240 416
WIRE 560 416 400 416
WIRE 624 416 560 416
WIRE 64 432 -64 432
WIRE 176 432 64 432
WIRE 1888 448 1888 400
WIRE 1952 448 1888 448
WIRE 1952 464 1888 464
WIRE 2048 464 2016 464
WIRE 1952 480 1936 480
WIRE 208 496 208 448
WIRE 1936 496 1936 480
WIRE 1952 496 1936 496
WIRE 2128 496 2016 496
WIRE 2144 496 2128 496
WIRE 1792 512 1712 512
WIRE 1888 512 1888 464
WIRE 1888 512 1792 512
WIRE 1936 560 1936 496
WIRE 1952 560 1952 512
WIRE 1952 560 1936 560
WIRE 1968 560 1968 512
WIRE 1968 560 1952 560
WIRE 2000 560 1968 560
WIRE 2048 560 2048 464
WIRE 2048 560 2000 560
WIRE -144 576 -224 576
WIRE -80 576 -144 576
WIRE 2000 576 2000 560
WIRE -224 640 -224 576
WIRE -224 736 -224 720
WIRE -224 736 -384 736
WIRE 1744 736 1728 736
WIRE 1872 736 1744 736
WIRE 2032 736 1936 736
WIRE 2048 736 2032 736
WIRE 224 752 160 752
WIRE 320 752 224 752
WIRE 816 752 752 752
WIRE 912 752 816 752
WIRE -224 784 -224 736
WIRE 160 784 160 752
WIRE 752 784 752 752
WIRE -224 880 -224 864
WIRE -224 880 -384 880
WIRE -32 880 -224 880
WIRE 48 880 -32 880
WIRE 160 896 160 864
WIRE 320 896 160 896
WIRE 416 896 320 896
WIRE 752 896 752 864
WIRE 976 896 752 896
WIRE 1056 896 976 896
WIRE -224 912 -224 880
WIRE 160 912 160 896
WIRE 752 912 752 896
WIRE 1664 928 1648 928
WIRE 1808 928 1664 928
WIRE 1808 976 1808 928
WIRE 1856 976 1808 976
WIRE 1680 992 1648 992
WIRE 1856 992 1680 992
WIRE 2096 992 1920 992
WIRE 2160 992 2096 992
WIRE 1856 1008 1808 1008
WIRE 1856 1024 1840 1024
WIRE 1952 1024 1920 1024
WIRE 1840 1040 1840 1024
WIRE 1856 1040 1840 1040
WIRE 1680 1072 1648 1072
WIRE 1808 1072 1808 1008
WIRE 1808 1072 1680 1072
WIRE 1840 1088 1840 1040
WIRE 1872 1088 1872 1040
WIRE 1872 1088 1840 1088
WIRE 1904 1088 1872 1088
WIRE 1952 1088 1952 1024
WIRE 1952 1088 1904 1088
WIRE 480 1104 432 1104
WIRE 528 1104 480 1104
WIRE 1904 1136 1904 1088
WIRE 432 1168 432 1104
WIRE 272 1184 240 1184
WIRE 304 1184 272 1184
WIRE 240 1248 240 1184
WIRE 96 1264 0 1264
WIRE 208 1264 96 1264
WIRE 432 1280 432 1248
WIRE 432 1280 272 1280
WIRE 592 1280 432 1280
WIRE 656 1280 592 1280
WIRE 2016 1280 1936 1280
WIRE 2080 1280 2016 1280
WIRE -240 1296 -256 1296
WIRE -224 1296 -240 1296
WIRE -144 1296 -224 1296
WIRE 0 1296 -64 1296
WIRE 96 1296 0 1296
WIRE 208 1296 96 1296
WIRE -224 1328 -224 1296
WIRE 240 1360 240 1312
WIRE 2176 1360 1936 1360
WIRE 2192 1360 2176 1360
WIRE 480 1376 432 1376
WIRE 528 1376 480 1376
WIRE 1936 1392 1936 1360
WIRE -224 1440 -224 1408
WIRE 432 1440 432 1376
WIRE 272 1456 240 1456
WIRE 304 1456 272 1456
WIRE 1632 1472 1568 1472
WIRE 1888 1472 1632 1472
WIRE 240 1520 240 1456
WIRE 0 1536 0 1296
WIRE 96 1536 0 1536
WIRE 208 1536 96 1536
WIRE 432 1552 432 1520
WIRE 432 1552 272 1552
WIRE 592 1552 432 1552
WIRE 656 1552 592 1552
WIRE 96 1568 -32 1568
WIRE 208 1568 96 1568
WIRE 1936 1568 1936 1488
WIRE 240 1632 240 1584
FLAG 208 224 0
FLAG 240 48 VBATT
FLAG 448 -32 VBATT
FLAG 160 -128 0
FLAG 224 -368 VBATT
FLAG -624 -208 0
FLAG -528 -320 VBATT
FLAG -608 96 0
FLAG -528 -32 CURR_SENS
FLAG -272 160 CURR_SENS
FLAG -272 -176 BUTTON
FLAG -352 -64 0
FLAG -80 -80 1Vin+_CURR
FLAG 560 144 CURR_TRIG1
FLAG 160 992 0
FLAG 224 752 VBATT
FLAG -256 304 0
FLAG 64 160 1Vin+_CURR
FLAG 64 128 1Vin-_CURR
FLAG 272 -224 1Vin-_CURR
FLAG 208 496 0
FLAG 240 320 VBATT
FLAG 448 240 VBATT
FLAG 560 416 CURR_OC
FLAG 64 432 2Vin+_CURR
FLAG 64 400 2Vin-_CURR
FLAG 768 -160 0
FLAG 832 -400 VBATT
FLAG 928 -256 2Vin+_CURR
FLAG 240 1360 0
FLAG 272 1184 VBATT
FLAG 480 1104 VBATT
FLAG -240 1296 BRAKE_SENS
FLAG 592 1280 BRAKE_TRIG1
FLAG -224 1440 0
FLAG 96 1296 1Vin+_BRAKE
FLAG 96 1264 1Vin-_BRAKE
FLAG 240 1632 0
FLAG 272 1456 VBATT
FLAG 480 1376 VBATT
FLAG 592 1552 BRAKE_OC
FLAG 96 1568 2Vin+_BRAKE
FLAG 96 1536 2Vin-_BRAKE
FLAG 320 896 1Vin-_BRAKE
FLAG 752 992 0
FLAG 816 752 VBATT
FLAG 976 896 2Vin+_BRAKE
FLAG 2000 576 0
FLAG 1792 400 CURR_TRIG1
FLAG 1792 512 BRAKE_TRIG1
FLAG 2128 496 TRIG_CLR
FLAG 1744 736 TRIG_CLR
FLAG 2032 736 COUNT_TRIG
FLAG 1904 1136 0
FLAG 2096 992 BSPD_OKn
FLAG 1664 928 COUNT_TRIG
FLAG 1680 1072 BRAKE_OC
FLAG 1680 992 CURR_OC
FLAG 1632 1472 BRAKE_TRIG1
FLAG 1936 1568 0
FLAG 2176 1360 BRAKE_LIGHT_GND
FLAG 2016 1280 VBATT
FLAG -224 992 0
FLAG -144 576 VBATT
FLAG -32 880 BRAKE_SENS
SYMBOL Comparators\\LT1716 208 144 R0
SYMATTR InstName U1A
SYMBOL res 384 16 R0
SYMATTR InstName R1
SYMATTR Value 10k
SYMBOL res 144 -352 R0
SYMATTR InstName R2
SYMATTR Value 6.8k
SYMBOL res 144 -224 R0
SYMATTR InstName R3
SYMATTR Value 20k
SYMBOL voltage -624 -304 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 5
SYMBOL voltage -608 0 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 2
SYMBOL res -96 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 100
SYMBOL voltage -352 -160 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 5
SYMBOL res 144 768 R0
SYMATTR InstName R7
SYMATTR Value 30k
SYMBOL res 144 896 R0
SYMATTR InstName R8
SYMATTR Value 30k
SYMBOL res -272 176 R0
SYMATTR InstName R6
SYMATTR Value 10k
SYMBOL Comparators\\LT1716 208 416 R0
SYMATTR InstName U1B
SYMBOL res 384 288 R0
SYMATTR InstName R9
SYMATTR Value 10k
SYMBOL res 752 -384 R0
SYMATTR InstName R10
SYMATTR Value 100k
SYMBOL res 752 -256 R0
SYMATTR InstName R11
SYMATTR Value 10k
SYMBOL Comparators\\LT1716 240 1280 R0
SYMATTR InstName U1
SYMBOL res 416 1152 R0
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL res -240 1312 R0
SYMATTR InstName R13
SYMATTR Value 1000k
SYMBOL Comparators\\LT1716 240 1552 R0
SYMATTR InstName U2
SYMBOL res 416 1424 R0
SYMATTR InstName R14
SYMATTR Value 10k
SYMBOL res 736 768 R0
SYMATTR InstName R15
SYMATTR Value 100k
SYMBOL res 736 896 R0
SYMATTR InstName R16
SYMATTR Value 10k
SYMBOL Digital\\and 1984 416 R0
WINDOW 3 0 0 Invisible 0
SYMATTR Value Vhigh = 5 Vlow = 0 Ref = 2.5 td=5n
SYMATTR InstName A1
SYMBOL Digital\\inv 1872 672 R0
WINDOW 3 0 0 Invisible 0
SYMATTR Value Vhigh = 5 Vlow = 0 Ref = 2.5 td=5n
SYMATTR InstName A2
SYMBOL Digital\\or 1888 944 R0
WINDOW 3 101 117 Left 2
SYMATTR Value Vhigh = 5 Vlow = 0 Ref = 2.5 td=5n
SYMATTR InstName A3
SYMBOL nmos 1888 1392 R0
WINDOW 0 56 49 VTop 2
WINDOW 3 -16 67 VLeft 2
SYMATTR InstName Q2
SYMATTR Value Si4850EY
SYMBOL res 1920 1264 R0
SYMATTR InstName R17
SYMATTR Value 1k
SYMBOL res -48 1280 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 100
SYMBOL res -240 768 R0
SYMATTR InstName R18
SYMATTR Value 100k
SYMBOL res -240 896 R0
SYMATTR InstName R19
SYMATTR Value 80k
SYMBOL res -240 624 R0
SYMATTR InstName R20
SYMATTR Value 20k
TEXT -1088 -16 Left 2 ;CURR_SENS\n0.4 - 4.4V depending on current level,
TEXT -352 -328 Left 2 ;BUTTON to test\n5V Button is pressed\nFloat/GND no button press\n(Connect wire to immitate button press
TEXT 328 -320 Left 2 ;1Vin-\nReference Voltage for Current Trip
TEXT -752 -312 Left 2 !.tran 10
TEXT 312 824 Left 2 ;1Vin-_Brake\nReference Voltage for Brake Trip
TEXT 936 -352 Left 2 ;2Vin+\nReference Voltage for open circuit
TEXT 600 256 Left 2 ;CURR_TRIG1 and 2\nLow means OK\n0.4 < CURR_SENS < 3.4V
TEXT 632 1392 Left 2 ;BRAKE_TRIG 1and 2\nLow means OK or not pressed\n0.4 < BRAKE_SENS < 2.5
TEXT 920 800 Left 2 ;2Vin+_BRAKE\nReference Voltage for BRAKE OC
TEXT 688 88 Left 2 ;CURR_TRIG1\nHIGH if CURR_SENS > 3.4V (Above kW threshold)\nLOW if CURR_SENS < 3.4V (Below kW threshold)
TEXT 688 400 Left 2 ;CURR_TRIG1\nLOW if CURR_SENS > 0.4V (Sens is ok)\nHIGH if CURR_SENS < 0.4V (Open/Short Circuit/grounded)
TEXT 704 1208 Left 2 ;BRAKE_TRIG1 \nHIGH if BRAKE_SENS > 2.5V (Pressed)\nLOW if BRAKE_SENS < 2.5V (Not_Pressed)
TEXT 696 1512 Left 2 ;BRAKE_TRIG2\nHIGH if BRAKE_SENS < 0.5V (Open/Shoort Circuit/Grounded)\nLOW if BRAKE_SENS > 0.5V (Some voltage)
TEXT 1648 304 Left 2 ;NAND\nIf Current is sensed and brake is pressed, output low/0V\nWhich lets the counter count
TEXT 1680 680 Left 2 ;Replacement for counter, inverts it simply
TEXT 1936 880 Left 2 ;BSPD_OKn\nLow means no BSPD fault\nHigh means BSPD fault
TEXT 2056 1440 Left 2 ;Brake Light Ground\nGrounded when Brake is pressed (BRAKE_TRIG1 high)\n12V (will be floating in altium) when not pressed (low)
TEXT -280 1120 Left 2 ;This needs to be here for the current\nbutton test, but not for brake, doesn't \nhurt to have it though (100 ohm res)
TEXT -720 768 Left 2 ;BRAKE_SENS\n2V Brake not pressed\n4V Brake pressed
TEXT -688 912 Left 2 ;Close wire to simulate brake press.\nRemove BRAKE_SENS net to simulate\nOpen Circuit.
TEXT -672 1360 Left 2 ;This Pull Down Needs to be >> R19\nto not fuck with the voltage division
